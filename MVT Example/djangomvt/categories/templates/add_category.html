{% extends 'layout.html' %}

{% block mycontent %}

<h1 class="text-center">Додати категорій</h1>
<div class="row">
    <form class="col-md-12 ">
        <div class="mb-3">
            <label for="name" class="form-label">Назва</label>
            <input type="text" class="form-control" id="name" name="name">
        </div>

        <div class="mb-3">
            <label for="description">Опис:</label>
            <textarea class="form-control" id="description" rows="3"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Додати</button>
    </form>
</div>

{% endblock %}

{% block myScripts %}
<script>
    tinymce.init({
        selector: 'textarea',
        plugins: 'anchor autolink charmap codesample emoticons ' +
            'image link lists media searchreplace table visualblocks wordcount',
        toolbar: 'undo redo | blocks fontfamily fontsize | bold italic '+
            'underline strikethrough | link image media table | align '+
            'lineheight | numlist bullist indent outdent | emoticons charmap '+
            '| removeformat',
        automatic_uploads: true,
        images_file_types: "jpg,jpeg,png,webp",
        paste_data_images: false,
        
        setup: (editor) => {
            editor.on('Paste', async (e) => {
                e.preventDefault();
                console.log("Insert code", e);
                

                const clipboardData = e.clipboardData || e.originalEvent?.clipboardData;
                if (!clipboardData) return;

                const html = clipboardData.getData("text/html");
                const text = clipboardData.getData("text/plain");

                let contentToInsert = html || text;
                if (!contentToInsert) return;

                const temp = document.createElement("div");
                temp.innerHTML = contentToInsert;

                const imgs = Array.from(temp.querySelectorAll("img"));

                for (let img of imgs) {
                    const src = img.getAttribute("src");
                    if (!src || src.startsWith("http://127.0.0.1")) continue;
                    try {
                        console.log("Upload url", src);
                        img.setAttribute("src", "/images/default.jpg");
                        img.setAttribute("srcset","/images/default.jpg");
                    } catch (err) {
                        console.error("Failed to upload image:", err);
                    }
                }
                editor.insertContent(temp.innerHTML);
            });
        }
        

    });
</script>
{% endblock %}